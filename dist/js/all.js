"use strict";var registerServiceWorker=function(){"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js",{scope:"./"}).then(function(e){var t;e.installing?(t=e.installing,console.log("installing")):e.waiting?(t=e.waiting,console.log("waiting")):e.active&&(t=e.active,console.log("active")),t&&t.addEventListener("statechange",function(e){console.log(e.target.state)})}).catch(function(e){console.log(e)})};registerServiceWorker();var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"fetchRestaurants",value:function(n){var r=new XMLHttpRequest;r.open("GET",o.DATABASE_URL),r.onload=function(){if(200===r.status){var e=JSON.parse(r.responseText);n(null,e)}else{var t="Request failed. Returned status of "+r.status;n(t,null)}},r.send()}},{key:"fetchRestaurantById",value:function(r,a){o.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t.find(function(e){return e.id==r});n?a(null,n):a("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,a){o.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t.filter(function(e){return e.cuisine_type==r});a(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,a){o.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t.filter(function(e){return e.neighborhood==r});a(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,a,i){o.fetchRestaurants(function(e,t){if(e)i(e,null);else{var n=t;"all"!=r&&(n=n.filter(function(e){return e.cuisine_type==r})),"all"!=a&&(n=n.filter(function(e){return e.neighborhood==a})),i(null,n)}})}},{key:"fetchNeighborhoods",value:function(a){o.fetchRestaurants(function(e,n){if(e)a(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),t=r.filter(function(e,t){return r.indexOf(e)==t});a(null,t)}})}},{key:"fetchCuisines",value:function(a){o.fetchRestaurants(function(e,n){if(e)a(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),t=r.filter(function(e,t){return r.indexOf(e)==t});a(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/img/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:o.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),o}(),restaurants=void 0,neighborhoods=void 0,cuisines=void 0,markers=[];document.addEventListener("DOMContentLoaded",function(e){fetchNeighborhoods(),fetchCuisines()});var fetchNeighborhoods=function(){DBHelper.fetchNeighborhoods(function(e,t){e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,n=document.getElementById("neighborhoods-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(e,t){e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})},fillCuisinesHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines,n=document.getElementById("cuisines-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})};window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()};var map,updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,a=e[n].value,i=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(a,i,function(e,t){e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})},resetRestaurants=function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(function(e){return e.setMap(null)}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list");e.forEach(function(e){t.append(createRestaurantHTML(e))}),addMarkersToMap()},createRestaurantHTML=function(e){var t=document.createElement("article");t.className="flex-container",t.setAttribute("aria-label",e.name);var n=document.createElement("div");n.className="col-sm-6 col-md-5";var r=document.createElement("div");r.className="col-sm-6 col-md-7 restaurant-content";var a=document.createElement("img");a.className="restaurant-img",a.alt=e.name+" restaurant's photo",a.src=DBHelper.imageUrlForRestaurant(e);var i=a.src.replace(/(\.[\w\d_-]+)$/i,"-480$1");a.setAttribute("srcset",i+" 480w, "+a.src+" 800w"),a.setAttribute("sizes","(max-width: 576px) 480px, (max-width: 1200px) 480px"),n.append(a),t.append(n);var o=document.createElement("h2");o.innerHTML=e.name,r.append(o);var l=document.createElement("p");l.innerHTML=e.neighborhood,r.append(l);var s=document.createElement("p");s.innerHTML=e.address,r.append(s);var u=document.createElement("a");return u.innerHTML="View Details",u.href=DBHelper.urlForRestaurant(e),u.setAttribute("aria-label","View Details about "+e.name),r.append(u),t.append(r),t},addMarkersToMap=function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),self.markers.push(t)})},restaurant=void 0;window.initMap=function(){fetchRestaurantFromURL(function(e,t){e?console.log(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})};var fetchRestaurantFromURL=function(n){if(self.restaurant)n(null,self.restaurant);else{var e=getParameterByName("id");if(e)DBHelper.fetchRestaurantById(e,function(e,t){(self.restaurant=t)?(fillRestaurantHTML(),n(null,t)):console.error(e)});else{n("No restaurant id in URL",null)}}},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var t=document.getElementById("restaurant-img");t.className="restaurant-img",t.alt=e.name+" restaurant's photo",t.src=DBHelper.imageUrlForRestaurant(e);var n=t.src.replace(/(\.[\w\d_-]+)$/i,"-480$1");t.setAttribute("srcset",n+" 480w, "+t.src+" 800w"),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);var i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}},fillReviewsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,t=document.getElementById("reviews-container"),n=document.createElement("h3");if(n.innerHTML="Reviews",t.appendChild(n),!e){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void t.appendChild(r)}var a=document.getElementById("reviews-list");e.forEach(function(e){a.appendChild(createReviewHTML(e))}),t.appendChild(a)},createReviewHTML=function(e){var t=document.createElement("li"),n=document.createElement("div");n.className="flex-container review-title";var r=document.createElement("p");r.innerHTML=e.name,r.className="col",n.appendChild(r);var a=document.createElement("p");a.innerHTML=e.date,a.className="col text-right",n.appendChild(a),t.appendChild(n);var i=document.createElement("div");i.className="review-content";var o=document.createElement("p");o.innerHTML="Rating: "+e.rating,o.classList.add("badge"),i.appendChild(o);var l=document.createElement("p");return l.innerHTML=e.comments,i.appendChild(l),t.appendChild(i),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,n.setAttribute("aria-level",2),n.setAttribute("aria-current","page"),t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZ2lzdGVyX3N3LmpzIiwiZGJoZWxwZXIuanMiLCJtYWluLmpzIiwicmVzdGF1cmFudF9pbmZvLmpzIl0sIm5hbWVzIjpbInJlZ2lzdGVyU2VydmljZVdvcmtlciIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsInNjb3BlIiwidGhlbiIsInJlZ2lzdHJhdGlvbiIsImluc3RhbGxpbmciLCJjb25zb2xlIiwibG9nIiwid2FpdGluZyIsImFjdGl2ZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwidGFyZ2V0Iiwic3RhdGUiLCJjYXRjaCIsImVycm9yIiwiREJIZWxwZXIiLCJjYWxsYmFjayIsInhociIsIlhNTEh0dHBSZXF1ZXN0Iiwib3BlbiIsIkRBVEFCQVNFX1VSTCIsIm9ubG9hZCIsInN0YXR1cyIsImpzb24iLCJKU09OIiwicGFyc2UiLCJyZXNwb25zZVRleHQiLCJzZW5kIiwiaWQiLCJmZXRjaFJlc3RhdXJhbnRzIiwicmVzdGF1cmFudHMiLCJyZXN0YXVyYW50IiwiZmluZCIsInIiLCJjdWlzaW5lIiwicmVzdWx0cyIsImZpbHRlciIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsIm5laWdoYm9yaG9vZHMiLCJtYXAiLCJ2IiwiaSIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmlxdWVDdWlzaW5lcyIsInBob3RvZ3JhcGgiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsIm5hbWUiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsIm1hcmtlcnMiLCJkb2N1bWVudCIsImV2ZW50IiwiZmV0Y2hOZWlnaGJvcmhvb2RzIiwiZmV0Y2hDdWlzaW5lcyIsInNlbGYiLCJmaWxsTmVpZ2hib3Job29kc0hUTUwiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJzZWxlY3QiLCJnZXRFbGVtZW50QnlJZCIsImZvckVhY2giLCJvcHRpb24iLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwidmFsdWUiLCJhcHBlbmQiLCJmaWxsQ3Vpc2luZXNIVE1MIiwid2luZG93IiwiaW5pdE1hcCIsIk1hcCIsInpvb20iLCJjZW50ZXIiLCJsYXQiLCJsbmciLCJzY3JvbGx3aGVlbCIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiY1NlbGVjdCIsIm5TZWxlY3QiLCJjSW5kZXgiLCJzZWxlY3RlZEluZGV4IiwibkluZGV4IiwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kIiwicmVzZXRSZXN0YXVyYW50cyIsImZpbGxSZXN0YXVyYW50c0hUTUwiLCJtIiwic2V0TWFwIiwidWwiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImFkZE1hcmtlcnNUb01hcCIsImFydGljbGUiLCJjbGFzc05hbWUiLCJzZXRBdHRyaWJ1dGUiLCJhcnRpY2xlVGh1bWIiLCJhcnRpY2xlQ29udGVudCIsImltYWdlIiwiYWx0Iiwic3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiaW1hZ2U0ODAiLCJyZXBsYWNlIiwiYWRkcmVzcyIsIm1vcmUiLCJocmVmIiwibWFya2VyIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImFkZExpc3RlbmVyIiwibG9jYXRpb24iLCJwdXNoIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsImZpbGxCcmVhZGNydW1iIiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwiZmV0Y2hSZXN0YXVyYW50QnlJZCIsImZpbGxSZXN0YXVyYW50SFRNTCIsIm9wZXJhdGluZ19ob3VycyIsImZpbGxSZXN0YXVyYW50SG91cnNIVE1MIiwiZmlsbFJldmlld3NIVE1MIiwib3BlcmF0aW5nSG91cnMiLCJob3VycyIsImtleSIsInJvdyIsImRheSIsImFwcGVuZENoaWxkIiwidGltZSIsInJldmlld3MiLCJjb250YWluZXIiLCJub1Jldmlld3MiLCJyZXZpZXciLCJjcmVhdGVSZXZpZXdIVE1MIiwibGkiLCJyZXZpZXdUaXRsZSIsImRhdGUiLCJyZXZpZXdDb250ZW50IiwicmF0aW5nIiwiY2xhc3NMaXN0IiwiYWRkIiwiY29tbWVudHMiLCJicmVhZGNydW1iIiwiUmVnRXhwIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCJdLCJtYXBwaW5ncyI6ImFBQUEsSUFBTUEsc0JBQXdCLFdBQ3pCLGtCQUFtQkMsV0FDdEJBLFVBQVVDLGNBQWNDLFNBQVMsUUFBUyxDQUN6Q0MsTUFBTyxPQUNMQyxLQUFLLFNBQUNDLEdBQ0wsSUFBSUosRUFDQUksRUFBYUMsWUFDYkwsRUFBZ0JJLEVBQWFDLFdBQzdCQyxRQUFRQyxJQUFJLGVBQ0xILEVBQWFJLFNBQ3BCUixFQUFnQkksRUFBYUksUUFDN0JGLFFBQVFDLElBQUksWUFDTEgsRUFBYUssU0FDcEJULEVBQWdCSSxFQUFhSyxPQUM3QkgsUUFBUUMsSUFBSSxXQUVaUCxHQUVBQSxFQUFjVSxpQkFBaUIsY0FBZSxTQUFVQyxHQUVwREwsUUFBUUMsSUFBSUksRUFBRUMsT0FBT0MsV0FHNUJDLE1BQU0sU0FBQUMsR0FDUFQsUUFBUUMsSUFBSVEsTUFLbEJqQiw0WUMxQk1rQiw0SEFjb0JDLEdBQ3RCLElBQUlDLEVBQU0sSUFBSUMsZUFDZEQsRUFBSUUsS0FBSyxNQUFPSixFQUFTSyxjQUN6QkgsRUFBSUksT0FBUyxXQUNYLEdBQW1CLE1BQWZKLEVBQUlLLE9BQWdCLENBQ3RCLElBQU1DLEVBQU9DLEtBQUtDLE1BQU1SLEVBQUlTLGNBRTVCVixFQUFTLEtBRFdPLE9BRWYsQ0FDTCxJQUFNVCxFQUFBQSxzQ0FBK0NHLEVBQUlLLE9BQ3pETixFQUFTRixFQUFPLFFBR3BCRyxFQUFJVSxtREFNcUJDLEVBQUlaLEdBRTdCRCxFQUFTYyxpQkFBaUIsU0FBQ2YsRUFBT2dCLEdBQ2hDLEdBQUloQixFQUNGRSxFQUFTRixFQUFPLFVBQ1gsQ0FDTCxJQUFNaUIsRUFBYUQsRUFBWUUsS0FBSyxTQUFBQyxHQUFBLE9BQUtBLEVBQUVMLElBQU1BLElBQzdDRyxFQUNGZixFQUFT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QUYsVUFBQSxHQUFBQSxVQUFBLEdBQXBCRixLQUFLbEMsV0FDaENxSCxFQUFhdkYsU0FBU1UsZUFBZSxjQUNyQ3FFLEVBQUsvRSxTQUFTYSxjQUFjLE1BQ25Da0UsRUFBR2pFLFVBQVk1QyxFQUFXdUIsS0FDMUJzRixFQUFHckMsYUFBYSxhQUFjLEdBQzdCcUMsRUFBR3JDLGFBQWEsZUFBZ0IsUUFDaEM2QyxFQUFXZixZQUFZTyxJQU1uQmxCLG1CQUFxQixTQUFDcEUsRUFBTUMsR0FDM0JBLElBQ0hBLEVBQU13QixPQUFPdUMsU0FBU0osTUFDeEI1RCxFQUFPQSxFQUFLeUQsUUFBUSxVQUFXLFFBQy9CLElBQ0U1RSxFQURZLElBQUlrSCxPQUFKLE9BQWtCL0YsRUFBbEIscUJBQ0lnRyxLQUFLL0YsR0FDdkIsT0FBS3BCLEVBRUFBLEVBQVEsR0FFTm9ILG1CQUFtQnBILEVBQVEsR0FBRzRFLFFBQVEsTUFBTyxNQUQzQyxHQUZBIiwiZmlsZSI6ImFsbC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHJlZ2lzdGVyU2VydmljZVdvcmtlciA9ICgpID0+IHtcclxuXHRpZiAoJ3NlcnZpY2VXb3JrZXInIGluIG5hdmlnYXRvcikge1xyXG5cdFx0bmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJ3N3LmpzJywge1xyXG5cdFx0XHRzY29wZTogJy4vJ1xyXG5cdFx0fSkudGhlbigocmVnaXN0cmF0aW9uKSA9PiB7XHJcbiAgICAgIHZhciBzZXJ2aWNlV29ya2VyO1xyXG4gICAgICBpZiAocmVnaXN0cmF0aW9uLmluc3RhbGxpbmcpIHtcclxuICAgICAgICAgIHNlcnZpY2VXb3JrZXIgPSByZWdpc3RyYXRpb24uaW5zdGFsbGluZztcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdpbnN0YWxsaW5nJyk7XHJcbiAgICAgIH0gZWxzZSBpZiAocmVnaXN0cmF0aW9uLndhaXRpbmcpIHtcclxuICAgICAgICAgIHNlcnZpY2VXb3JrZXIgPSByZWdpc3RyYXRpb24ud2FpdGluZztcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCd3YWl0aW5nJyk7XHJcbiAgICAgIH0gZWxzZSBpZiAocmVnaXN0cmF0aW9uLmFjdGl2ZSkge1xyXG4gICAgICAgICAgc2VydmljZVdvcmtlciA9IHJlZ2lzdHJhdGlvbi5hY3RpdmU7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnYWN0aXZlJyk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHNlcnZpY2VXb3JrZXIpIHtcclxuICAgICAgICAgIC8vIGxvZ1N0YXRlKHNlcnZpY2VXb3JrZXIuc3RhdGUpO1xyXG4gICAgICAgICAgc2VydmljZVdvcmtlci5hZGRFdmVudExpc3RlbmVyKCdzdGF0ZWNoYW5nZScsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgLy8gbG9nU3RhdGUoZS50YXJnZXQuc3RhdGUpO1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUudGFyZ2V0LnN0YXRlKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KS5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcclxuICAgIH0pO1xyXG5cdH1cclxufVxyXG5cclxucmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCk7IiwiLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxuY2xhc3MgREJIZWxwZXIge1xyXG5cclxuICAvKipcclxuICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xyXG4gICAgY29uc3QgcG9ydCA9IDEzMzcgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmVzdGF1cmFudHNgO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcbiAgICBsZXQgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICB4aHIub3BlbignR0VUJywgREJIZWxwZXIuREFUQUJBU0VfVVJMKTtcclxuICAgIHhoci5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgIGlmICh4aHIuc3RhdHVzID09PSAyMDApIHsgLy8gR290IGEgc3VjY2VzcyByZXNwb25zZSBmcm9tIHNlcnZlciFcclxuICAgICAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTtcclxuICAgICAgICBjb25zdCByZXN0YXVyYW50cyA9IGpzb247IC8vanNvbi5yZXN0YXVyYW50cztcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XHJcbiAgICAgIH0gZWxzZSB7IC8vIE9vcHMhLiBHb3QgYW4gZXJyb3IgZnJvbSBzZXJ2ZXIuXHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSAoYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHt4aHIuc3RhdHVzfWApO1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHhoci5zZW5kKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChyID0+IHIuaWQgPT0gaWQpO1xyXG4gICAgICAgIGlmIChyZXN0YXVyYW50KSB7IC8vIEdvdCB0aGUgcmVzdGF1cmFudFxyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XHJcbiAgICAgICAgfSBlbHNlIHsgLy8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2VcclxuICAgICAgICAgIGNhbGxiYWNrKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JywgbnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50c1xyXG4gICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKVxyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcigodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGkpXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxyXG4gICAgICBtYXA6IG1hcCxcclxuICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUH1cclxuICAgICk7XHJcbiAgICByZXR1cm4gbWFya2VyO1xyXG4gIH1cclxuXHJcbn1cclxuIiwibGV0IHJlc3RhdXJhbnRzLFxyXG4gIG5laWdoYm9yaG9vZHMsXHJcbiAgY3Vpc2luZXNcclxudmFyIG1hcFxyXG52YXIgbWFya2VycyA9IFtdXHJcblxyXG4vKipcclxuICogRmV0Y2ggbmVpZ2hib3Job29kcyBhbmQgY3Vpc2luZXMgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXHJcbiAqL1xyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKGV2ZW50KSA9PiB7XHJcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XHJcblx0ZmV0Y2hDdWlzaW5lcygpO1xyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5jb25zdCBmZXRjaE5laWdoYm9yaG9vZHMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKChlcnJvciwgbmVpZ2hib3Job29kcykgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvclxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XHJcbiAgICAgIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogU2V0IG5laWdoYm9yaG9vZHMgSFRNTC5cclxuICovXHJcbmNvbnN0IGZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcbiAgbmVpZ2hib3Job29kcy5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuY29uc3QgZmV0Y2hDdWlzaW5lcyA9ICgpID0+IHtcclxuICBEQkhlbHBlci5mZXRjaEN1aXNpbmVzKChlcnJvciwgY3Vpc2luZXMpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5jdWlzaW5lcyA9IGN1aXNpbmVzO1xyXG4gICAgICBmaWxsQ3Vpc2luZXNIVE1MKCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cclxuICovXHJcbmNvbnN0IGZpbGxDdWlzaW5lc0hUTUwgPSAoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG5cclxuICBjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcclxuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXHJcbiAqL1xyXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcclxuICBsZXQgbG9jID0ge1xyXG4gICAgbGF0OiA0MC43MjIyMTYsXHJcbiAgICBsbmc6IC03My45ODc1MDFcclxuICB9O1xyXG4gIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuICAgIHpvb206IDEyLFxyXG4gICAgY2VudGVyOiBsb2MsXHJcbiAgICBzY3JvbGx3aGVlbDogZmFsc2VcclxuICB9KTtcclxuICB1cGRhdGVSZXN0YXVyYW50cygpO1xyXG59XHJcblxyXG4vKipcclxuICogVXBkYXRlIHBhZ2UgYW5kIG1hcCBmb3IgY3VycmVudCByZXN0YXVyYW50cy5cclxuICovXHJcbmNvbnN0IHVwZGF0ZVJlc3RhdXJhbnRzID0gKCkgPT4ge1xyXG4gIGNvbnN0IGNTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XHJcbiAgY29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xyXG5cclxuICBjb25zdCBjSW5kZXggPSBjU2VsZWN0LnNlbGVjdGVkSW5kZXg7XHJcbiAgY29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG5cclxuICBjb25zdCBjdWlzaW5lID0gY1NlbGVjdFtjSW5kZXhdLnZhbHVlO1xyXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3RbbkluZGV4XS52YWx1ZTtcclxuXHJcbiAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcclxuICAgICAgZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXHJcbiAqL1xyXG5jb25zdCByZXNldFJlc3RhdXJhbnRzID0gKHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcbiAgdWwuaW5uZXJIVE1MID0gJyc7XHJcblxyXG4gIC8vIFJlbW92ZSBhbGwgbWFwIG1hcmtlcnNcclxuICBzZWxmLm1hcmtlcnMuZm9yRWFjaChtID0+IG0uc2V0TWFwKG51bGwpKTtcclxuICBzZWxmLm1hcmtlcnMgPSBbXTtcclxuICBzZWxmLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuY29uc3QgZmlsbFJlc3RhdXJhbnRzSFRNTCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIHVsLmFwcGVuZChjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KSk7XHJcbiAgfSk7XHJcbiAgYWRkTWFya2Vyc1RvTWFwKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxyXG4gKi9cclxuY29uc3QgY3JlYXRlUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCkgPT4ge1xyXG5cdGNvbnN0IGFydGljbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhcnRpY2xlJyk7XHJcbiAgYXJ0aWNsZS5jbGFzc05hbWUgPSAnZmxleC1jb250YWluZXInO1xyXG4gIGFydGljbGUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgcmVzdGF1cmFudC5uYW1lKTtcclxuXHRjb25zdCBhcnRpY2xlVGh1bWIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRhcnRpY2xlVGh1bWIuY2xhc3NOYW1lID0gJ2NvbC1zbS02IGNvbC1tZC01JztcclxuXHRjb25zdCBhcnRpY2xlQ29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdGFydGljbGVDb250ZW50LmNsYXNzTmFtZSA9ICdjb2wtc20tNiBjb2wtbWQtNyByZXN0YXVyYW50LWNvbnRlbnQnO1xyXG5cclxuXHQvKiBUaHVtYm5haWwgKi9cclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG5cdGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XHJcblx0aW1hZ2UuYWx0ID0gYCR7cmVzdGF1cmFudC5uYW1lfSByZXN0YXVyYW50J3MgcGhvdG9gO1xyXG5cdGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuXHRcclxuXHQvLyBTZXQgc3Jjc2V0IGZvciByZXNwb25zaXZlXHJcblx0Y29uc3QgaW1hZ2U0ODAgPSBpbWFnZS5zcmMucmVwbGFjZSgvKFxcLltcXHdcXGRfLV0rKSQvaSwgJy00ODAkMScpXHJcblx0aW1hZ2Uuc2V0QXR0cmlidXRlKCdzcmNzZXQnLCBgJHtpbWFnZTQ4MH0gNDgwdywgJHtpbWFnZS5zcmN9IDgwMHdgKTtcclxuXHRpbWFnZS5zZXRBdHRyaWJ1dGUoJ3NpemVzJywgJyhtYXgtd2lkdGg6IDU3NnB4KSA0ODBweCwgKG1heC13aWR0aDogMTIwMHB4KSA0ODBweCcpO1xyXG5cclxuXHRhcnRpY2xlVGh1bWIuYXBwZW5kKGltYWdlKTtcclxuXHRhcnRpY2xlLmFwcGVuZChhcnRpY2xlVGh1bWIpO1xyXG5cclxuXHQvKiBDb250ZW50ICovXHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgYXJ0aWNsZUNvbnRlbnQuYXBwZW5kKG5hbWUpO1xyXG5cclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xyXG4gIGFydGljbGVDb250ZW50LmFwcGVuZChuZWlnaGJvcmhvb2QpO1xyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG4gIGFydGljbGVDb250ZW50LmFwcGVuZChhZGRyZXNzKTtcclxuXHJcbiAgY29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICBtb3JlLmlubmVySFRNTCA9ICdWaWV3IERldGFpbHMnO1xyXG4gIG1vcmUuaHJlZiA9IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgbW9yZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnVmlldyBEZXRhaWxzIGFib3V0ICcrIHJlc3RhdXJhbnQubmFtZSk7XHJcblx0YXJ0aWNsZUNvbnRlbnQuYXBwZW5kKG1vcmUpO1xyXG5cdGFydGljbGUuYXBwZW5kKGFydGljbGVDb250ZW50KTtcclxuXHJcbiAgcmV0dXJuIGFydGljbGU7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxyXG4gKi9cclxuY29uc3QgYWRkTWFya2Vyc1RvTWFwID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICAvLyBBZGQgbWFya2VyIHRvIHRoZSBtYXBcclxuICAgIGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybFxyXG4gICAgfSk7XHJcbiAgICBzZWxmLm1hcmtlcnMucHVzaChtYXJrZXIpO1xyXG4gIH0pO1xyXG59IiwibGV0IHJlc3RhdXJhbnQ7XHJcbnZhciBtYXA7XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIC8vY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuICAgICAgICB6b29tOiAxNixcclxuICAgICAgICBjZW50ZXI6IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxyXG4gICAgICB9KTtcclxuICAgICAgZmlsbEJyZWFkY3J1bWIoKTtcclxuICAgICAgREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChzZWxmLnJlc3RhdXJhbnQsIHNlbGYubWFwKTtcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cclxuICovXHJcbmNvbnN0IGZldGNoUmVzdGF1cmFudEZyb21VUkwgPSAoY2FsbGJhY2spID0+IHtcclxuICBpZiAoc2VsZi5yZXN0YXVyYW50KSB7IC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxyXG4gICAgY2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KVxyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcclxuICBpZiAoIWlkKSB7IC8vIG5vIGlkIGZvdW5kIGluIFVSTFxyXG4gICAgbGV0IGVycm9yID0gJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJ1xyXG4gICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCAoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcclxuICAgICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcclxuICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGZpbGxSZXN0YXVyYW50SFRNTCgpO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlXHJcbiAqL1xyXG5jb25zdCBmaWxsUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcblxyXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XHJcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XHJcblxyXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJyk7XHJcblx0aW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcclxuXHRpbWFnZS5hbHQgPSBgJHtyZXN0YXVyYW50Lm5hbWV9IHJlc3RhdXJhbnQncyBwaG90b2A7XHJcblx0aW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG5cdFxyXG5cdC8vIFNldCBzcmNzZXQgZm9yIHJlc3BvbnNpdmVcclxuXHRjb25zdCBpbWFnZTQ4MCA9IGltYWdlLnNyYy5yZXBsYWNlKC8oXFwuW1xcd1xcZF8tXSspJC9pLCAnLTQ4MCQxJylcclxuXHRpbWFnZS5zZXRBdHRyaWJ1dGUoJ3NyY3NldCcsIGAke2ltYWdlNDgwfSA0ODB3LCAke2ltYWdlLnNyY30gODAwd2ApO1xyXG5cclxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xyXG4gIGN1aXNpbmUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5jdWlzaW5lX3R5cGU7XHJcblxyXG4gIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXHJcbiAgaWYgKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XHJcbiAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xyXG4gIH1cclxuICAvLyBmaWxsIHJldmlld3NcclxuICBmaWxsUmV2aWV3c0hUTUwoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5jb25zdCBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IChvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpID0+IHtcclxuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XHJcbiAgZm9yIChsZXQga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XHJcbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xyXG5cclxuICAgIGNvbnN0IGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XHJcbiAgICBkYXkuaW5uZXJIVE1MID0ga2V5O1xyXG4gICAgcm93LmFwcGVuZENoaWxkKGRheSk7XHJcblxyXG4gICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XHJcbiAgICB0aW1lLmlubmVySFRNTCA9IG9wZXJhdGluZ0hvdXJzW2tleV07XHJcbiAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XHJcblxyXG4gICAgaG91cnMuYXBwZW5kQ2hpbGQocm93KTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5jb25zdCBmaWxsUmV2aWV3c0hUTUwgPSAocmV2aWV3cyA9IHNlbGYucmVzdGF1cmFudC5yZXZpZXdzKSA9PiB7XHJcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XHJcbiAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpO1xyXG4gIHRpdGxlLmlubmVySFRNTCA9ICdSZXZpZXdzJztcclxuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xyXG5cclxuICBpZiAoIXJldmlld3MpIHtcclxuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICAgIG5vUmV2aWV3cy5pbm5lckhUTUwgPSAnTm8gcmV2aWV3cyB5ZXQhJztcclxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcclxuICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcclxuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XHJcbiAgfSk7XHJcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuY29uc3QgY3JlYXRlUmV2aWV3SFRNTCA9IChyZXZpZXcpID0+IHtcclxuXHRjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcblx0Y29uc3QgcmV2aWV3VGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRyZXZpZXdUaXRsZS5jbGFzc05hbWUgPSAnZmxleC1jb250YWluZXIgcmV2aWV3LXRpdGxlJztcclxuXHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xyXG5cdG5hbWUuY2xhc3NOYW1lID0gJ2NvbCc7XHJcblx0cmV2aWV3VGl0bGUuYXBwZW5kQ2hpbGQobmFtZSk7XHJcblxyXG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgZGF0ZS5pbm5lckhUTUwgPSByZXZpZXcuZGF0ZTtcclxuXHRkYXRlLmNsYXNzTmFtZSA9ICdjb2wgdGV4dC1yaWdodCc7XHJcblx0cmV2aWV3VGl0bGUuYXBwZW5kQ2hpbGQoZGF0ZSk7XHJcblxyXG5cdGxpLmFwcGVuZENoaWxkKHJldmlld1RpdGxlKTtcclxuXHJcblx0Y29uc3QgcmV2aWV3Q29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdHJldmlld0NvbnRlbnQuY2xhc3NOYW1lID0gJ3Jldmlldy1jb250ZW50JztcclxuXHJcbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG5cdHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcclxuXHRyYXRpbmcuY2xhc3NMaXN0LmFkZCgnYmFkZ2UnKTtcclxuICByZXZpZXdDb250ZW50LmFwcGVuZENoaWxkKHJhdGluZyk7XHJcblxyXG4gIGNvbnN0IGNvbW1lbnRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcclxuXHRyZXZpZXdDb250ZW50LmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcclxuXHRcclxuXHRsaS5hcHBlbmRDaGlsZChyZXZpZXdDb250ZW50KTtcclxuXHJcbiAgcmV0dXJuIGxpO1xyXG59XHJcblxyXG4vKipcclxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcclxuICovXHJcbmNvbnN0IGZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQ9c2VsZi5yZXN0YXVyYW50KSA9PiB7XHJcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG5cdGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcclxuXHRsaS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGV2ZWwnLCAyKTtcclxuICBsaS5zZXRBdHRyaWJ1dGUoJ2FyaWEtY3VycmVudCcsICdwYWdlJyk7XHJcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxyXG4gKi9cclxuY29uc3QgZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xyXG4gIGlmICghdXJsKVxyXG4gICAgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XHJcbiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgJ1xcXFwkJicpO1xyXG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxyXG4gICAgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcclxuICBpZiAoIXJlc3VsdHMpXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICBpZiAoIXJlc3VsdHNbMl0pXHJcbiAgICByZXR1cm4gJyc7XHJcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcclxufSJdfQ==
