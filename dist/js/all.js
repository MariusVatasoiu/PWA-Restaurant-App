"use strict";var registerServiceWorker=function(){"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js",{scope:"./"}).then(function(e){var t;e.installing?(t=e.installing,console.log("installing")):e.waiting?(t=e.waiting,console.log("waiting")):e.active&&(t=e.active,console.log("active")),t&&t.addEventListener("statechange",function(e){console.log(e.target.state)})}).catch(function(e){console.log(e)})};registerServiceWorker();var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"fetchRestaurants",value:function(n){var r=new XMLHttpRequest;r.open("GET",o.DATABASE_URL),r.onload=function(){if(200===r.status){var e=JSON.parse(r.responseText).restaurants;n(null,e)}else{var t="Request failed. Returned status of "+r.status;n(t,null)}},r.send()}},{key:"fetchRestaurantById",value:function(r,a){o.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t.find(function(e){return e.id==r});n?a(null,n):a("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,a){o.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t.filter(function(e){return e.cuisine_type==r});a(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,a){o.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t.filter(function(e){return e.neighborhood==r});a(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,a,i){o.fetchRestaurants(function(e,t){if(e)i(e,null);else{var n=t;"all"!=r&&(n=n.filter(function(e){return e.cuisine_type==r})),"all"!=a&&(n=n.filter(function(e){return e.neighborhood==a})),i(null,n)}})}},{key:"fetchNeighborhoods",value:function(a){o.fetchRestaurants(function(e,n){if(e)a(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),t=r.filter(function(e,t){return r.indexOf(e)==t});a(null,t)}})}},{key:"fetchCuisines",value:function(a){o.fetchRestaurants(function(e,n){if(e)a(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),t=r.filter(function(e,t){return r.indexOf(e)==t});a(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/img/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:o.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:8000/data/restaurants.json"}}]),o}(),restaurants=void 0,neighborhoods=void 0,cuisines=void 0,markers=[];document.addEventListener("DOMContentLoaded",function(e){fetchNeighborhoods(),fetchCuisines()});var fetchNeighborhoods=function(){DBHelper.fetchNeighborhoods(function(e,t){e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,n=document.getElementById("neighborhoods-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(e,t){e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})},fillCuisinesHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines,n=document.getElementById("cuisines-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})};window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()};var map,updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,a=e[n].value,i=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(a,i,function(e,t){e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})},resetRestaurants=function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(function(e){return e.setMap(null)}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list");e.forEach(function(e){t.append(createRestaurantHTML(e))}),addMarkersToMap()},createRestaurantHTML=function(e){var t=document.createElement("article");t.className="flex-container",t.setAttribute("aria-label",e.name);var n=document.createElement("div");n.className="col-sm-6 col-md-5";var r=document.createElement("div");r.className="col-sm-6 col-md-7 restaurant-content";var a=document.createElement("img");a.className="restaurant-img",a.alt=e.name+" restaurant's photo",a.src=DBHelper.imageUrlForRestaurant(e);var i=a.src.replace(/(\.[\w\d_-]+)$/i,"-480$1");a.setAttribute("srcset",i+" 480w, "+a.src+" 800w"),a.setAttribute("sizes","(max-width: 576px) 480px, (max-width: 1200px) 480px"),n.append(a),t.append(n);var o=document.createElement("h2");o.innerHTML=e.name,r.append(o);var l=document.createElement("p");l.innerHTML=e.neighborhood,r.append(l);var s=document.createElement("p");s.innerHTML=e.address,r.append(s);var u=document.createElement("a");return u.innerHTML="View Details",u.href=DBHelper.urlForRestaurant(e),u.setAttribute("aria-label","View Details about "+e.name),r.append(u),t.append(r),t},addMarkersToMap=function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),self.markers.push(t)})},restaurant=void 0;window.initMap=function(){fetchRestaurantFromURL(function(e,t){e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})};var fetchRestaurantFromURL=function(n){if(self.restaurant)n(null,self.restaurant);else{var e=getParameterByName("id");if(e)DBHelper.fetchRestaurantById(e,function(e,t){(self.restaurant=t)?(fillRestaurantHTML(),n(null,t)):console.error(e)});else{n("No restaurant id in URL",null)}}},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var t=document.getElementById("restaurant-img");t.className="restaurant-img",t.alt=e.name+" restaurant's photo",t.src=DBHelper.imageUrlForRestaurant(e);var n=t.src.replace(/(\.[\w\d_-]+)$/i,"-480$1");t.setAttribute("srcset",n+" 480w, "+t.src+" 800w"),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);var i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}},fillReviewsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,t=document.getElementById("reviews-container"),n=document.createElement("h3");if(n.innerHTML="Reviews",t.appendChild(n),!e){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void t.appendChild(r)}var a=document.getElementById("reviews-list");e.forEach(function(e){a.appendChild(createReviewHTML(e))}),t.appendChild(a)},createReviewHTML=function(e){var t=document.createElement("li"),n=document.createElement("div");n.className="flex-container review-title";var r=document.createElement("p");r.innerHTML=e.name,r.className="col",n.appendChild(r);var a=document.createElement("p");a.innerHTML=e.date,a.className="col text-right",n.appendChild(a),t.appendChild(n);var i=document.createElement("div");i.className="review-content";var o=document.createElement("p");o.innerHTML="Rating: "+e.rating,o.classList.add("badge"),i.appendChild(o);var l=document.createElement("p");return l.innerHTML=e.comments,i.appendChild(l),t.appendChild(i),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,n.setAttribute("aria-level",2),n.setAttribute("aria-current","page"),t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZ2lzdGVyX3N3LmpzIiwiZGJoZWxwZXIuanMiLCJtYWluLmpzIiwicmVzdGF1cmFudF9pbmZvLmpzIl0sIm5hbWVzIjpbInJlZ2lzdGVyU2VydmljZVdvcmtlciIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsInNjb3BlIiwidGhlbiIsInJlZ2lzdHJhdGlvbiIsImluc3RhbGxpbmciLCJjb25zb2xlIiwibG9nIiwid2FpdGluZyIsImFjdGl2ZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwidGFyZ2V0Iiwic3RhdGUiLCJjYXRjaCIsImVycm9yIiwiREJIZWxwZXIiLCJjYWxsYmFjayIsInhociIsIlhNTEh0dHBSZXF1ZXN0Iiwib3BlbiIsIkRBVEFCQVNFX1VSTCIsIm9ubG9hZCIsInN0YXR1cyIsInJlc3RhdXJhbnRzIiwiSlNPTiIsInBhcnNlIiwicmVzcG9uc2VUZXh0Iiwic2VuZCIsImlkIiwiZmV0Y2hSZXN0YXVyYW50cyIsInJlc3RhdXJhbnQiLCJmaW5kIiwiciIsImN1aXNpbmUiLCJyZXN1bHRzIiwiZmlsdGVyIiwiY3Vpc2luZV90eXBlIiwibmVpZ2hib3Job29kIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwidW5pcXVlTmVpZ2hib3Job29kcyIsImluZGV4T2YiLCJjdWlzaW5lcyIsInVuaXF1ZUN1aXNpbmVzIiwicGhvdG9ncmFwaCIsImdvb2dsZSIsIm1hcHMiLCJNYXJrZXIiLCJwb3NpdGlvbiIsImxhdGxuZyIsInRpdGxlIiwibmFtZSIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhbmltYXRpb24iLCJBbmltYXRpb24iLCJEUk9QIiwibWFya2VycyIsImRvY3VtZW50IiwiZXZlbnQiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJmZXRjaEN1aXNpbmVzIiwic2VsZiIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsInNlbGVjdCIsImdldEVsZW1lbnRCeUlkIiwiZm9yRWFjaCIsIm9wdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJ2YWx1ZSIsImFwcGVuZCIsImZpbGxDdWlzaW5lc0hUTUwiLCJ3aW5kb3ciLCJpbml0TWFwIiwiTWFwIiwiem9vbSIsImNlbnRlciIsImxhdCIsImxuZyIsInNjcm9sbHdoZWVsIiwidXBkYXRlUmVzdGF1cmFudHMiLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsIm0iLCJzZXRNYXAiLCJ1bCIsImNyZWF0ZVJlc3RhdXJhbnRIVE1MIiwiYWRkTWFya2Vyc1RvTWFwIiwiYXJ0aWNsZSIsImNsYXNzTmFtZSIsInNldEF0dHJpYnV0ZSIsImFydGljbGVUaHVtYiIsImFydGljbGVDb250ZW50IiwiaW1hZ2UiLCJhbHQiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJpbWFnZTQ4MCIsInJlcGxhY2UiLCJhZGRyZXNzIiwibW9yZSIsImhyZWYiLCJtYXJrZXIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiYWRkTGlzdGVuZXIiLCJsb2NhdGlvbiIsInB1c2giLCJmZXRjaFJlc3RhdXJhbnRGcm9tVVJMIiwiZmlsbEJyZWFkY3J1bWIiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwib3BlcmF0aW5nX2hvdXJzIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJmaWxsUmV2aWV3c0hUTUwiLCJvcGVyYXRpbmdIb3VycyIsImhvdXJzIiwia2V5Iiwicm93IiwiZGF5IiwiYXBwZW5kQ2hpbGQiLCJ0aW1lIiwicmV2aWV3cyIsImNvbnRhaW5lciIsIm5vUmV2aWV3cyIsInJldmlldyIsImNyZWF0ZVJldmlld0hUTUwiLCJsaSIsInJldmlld1RpdGxlIiwiZGF0ZSIsInJldmlld0NvbnRlbnQiLCJyYXRpbmciLCJjbGFzc0xpc3QiLCJhZGQiLCJjb21tZW50cyIsImJyZWFkY3J1bWIiLCJSZWdFeHAiLCJleGVjIiwiZGVjb2RlVVJJQ29tcG9uZW50Il0sIm1hcHBpbmdzIjoiYUFBQSxJQUFNQSxzQkFBd0IsV0FDekIsa0JBQW1CQyxXQUN0QkEsVUFBVUMsY0FBY0MsU0FBUyxRQUFTLENBQ3pDQyxNQUFPLE9BQ0xDLEtBQUssU0FBQ0MsR0FDTCxJQUFJSixFQUNBSSxFQUFhQyxZQUNiTCxFQUFnQkksRUFBYUMsV0FDN0JDLFFBQVFDLElBQUksZUFDTEgsRUFBYUksU0FDcEJSLEVBQWdCSSxFQUFhSSxRQUM3QkYsUUFBUUMsSUFBSSxZQUNMSCxFQUFhSyxTQUNwQlQsRUFBZ0JJLEVBQWFLLE9BQzdCSCxRQUFRQyxJQUFJLFdBRVpQLEdBRUFBLEVBQWNVLGlCQUFpQixjQUFlLFNBQVVDLEdBRXBETCxRQUFRQyxJQUFJSSxFQUFFQyxPQUFPQyxXQUc1QkMsTUFBTSxTQUFBQyxHQUNQVCxRQUFRQyxJQUFJUSxNQUtsQmpCLDRZQzFCTWtCLDRIQWNvQkMsR0FDdEIsSUFBSUMsRUFBTSxJQUFJQyxlQUNkRCxFQUFJRSxLQUFLLE1BQU9KLEVBQVNLLGNBQ3pCSCxFQUFJSSxPQUFTLFdBQ1gsR0FBbUIsTUFBZkosRUFBSUssT0FBZ0IsQ0FDdEIsSUFDTUMsRUFET0MsS0FBS0MsTUFBTVIsRUFBSVMsY0FDSEgsWUFDekJQLEVBQVMsS0FBTU8sT0FDVixDQUNMLElBQU1ULEVBQUFBLHNDQUErQ0csRUFBSUssT0FDekROLEVBQVNGLEVBQU8sUUFHcEJHLEVBQUlVLG1EQU1xQkMsRUFBSVosR0FFN0JELEVBQVNjLGlCQUFpQixTQUFDZixFQUFPUyxHQUNoQyxHQUFJVCxFQUNGRSxFQUFTRixFQUFPLFVBQ1gsQ0FDTCxJQUFNZ0IsRUFBYVAsRUFBWVEsS0FBSyxTQUFBQyxHQUFBLE9BQUtBLEVBQUVKLElBQU1BLElBQzdDRSxFQUNGZCxFQUFTLEtB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R0FBQUEsVUFBQSxHQUFwQkYsS0FBS2xDLFdBQ2hDcUgsRUFBYXZGLFNBQVNVLGVBQWUsY0FDckNxRSxFQUFLL0UsU0FBU2EsY0FBYyxNQUNuQ2tFLEVBQUdqRSxVQUFZNUMsRUFBV3VCLEtBQzFCc0YsRUFBR3JDLGFBQWEsYUFBYyxHQUM3QnFDLEVBQUdyQyxhQUFhLGVBQWdCLFFBQ2hDNkMsRUFBV2YsWUFBWU8sSUFNbkJsQixtQkFBcUIsU0FBQ3BFLEVBQU1DLEdBQzNCQSxJQUNIQSxFQUFNd0IsT0FBT3VDLFNBQVNKLE1BQ3hCNUQsRUFBT0EsRUFBS3lELFFBQVEsVUFBVyxRQUMvQixJQUNFNUUsRUFEWSxJQUFJa0gsT0FBSixPQUFrQi9GLEVBQWxCLHFCQUNJZ0csS0FBSy9GLEdBQ3ZCLE9BQUtwQixFQUVBQSxFQUFRLEdBRU5vSCxtQkFBbUJwSCxFQUFRLEdBQUc0RSxRQUFRLE1BQU8sTUFEM0MsR0FGQSIsImZpbGUiOiJhbGwuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCByZWdpc3RlclNlcnZpY2VXb3JrZXIgPSAoKSA9PiB7XHJcblx0aWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcclxuXHRcdG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCdzdy5qcycsIHtcclxuXHRcdFx0c2NvcGU6ICcuLydcclxuXHRcdH0pLnRoZW4oKHJlZ2lzdHJhdGlvbikgPT4ge1xyXG4gICAgICB2YXIgc2VydmljZVdvcmtlcjtcclxuICAgICAgaWYgKHJlZ2lzdHJhdGlvbi5pbnN0YWxsaW5nKSB7XHJcbiAgICAgICAgICBzZXJ2aWNlV29ya2VyID0gcmVnaXN0cmF0aW9uLmluc3RhbGxpbmc7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnaW5zdGFsbGluZycpO1xyXG4gICAgICB9IGVsc2UgaWYgKHJlZ2lzdHJhdGlvbi53YWl0aW5nKSB7XHJcbiAgICAgICAgICBzZXJ2aWNlV29ya2VyID0gcmVnaXN0cmF0aW9uLndhaXRpbmc7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnd2FpdGluZycpO1xyXG4gICAgICB9IGVsc2UgaWYgKHJlZ2lzdHJhdGlvbi5hY3RpdmUpIHtcclxuICAgICAgICAgIHNlcnZpY2VXb3JrZXIgPSByZWdpc3RyYXRpb24uYWN0aXZlO1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ2FjdGl2ZScpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChzZXJ2aWNlV29ya2VyKSB7XHJcbiAgICAgICAgICAvLyBsb2dTdGF0ZShzZXJ2aWNlV29ya2VyLnN0YXRlKTtcclxuICAgICAgICAgIHNlcnZpY2VXb3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignc3RhdGVjaGFuZ2UnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgIC8vIGxvZ1N0YXRlKGUudGFyZ2V0LnN0YXRlKTtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlLnRhcmdldC5zdGF0ZSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnJvcik7XHJcbiAgICB9KTtcclxuXHR9XHJcbn1cclxuXHJcbnJlZ2lzdGVyU2VydmljZVdvcmtlcigpOyIsIi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuXHJcbiAgLyoqXHJcbiAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgIGNvbnN0IHBvcnQgPSA4MDAwIC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L2RhdGEvcmVzdGF1cmFudHMuanNvbmA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudHMoY2FsbGJhY2spIHtcclxuICAgIGxldCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgIHhoci5vcGVuKCdHRVQnLCBEQkhlbHBlci5EQVRBQkFTRV9VUkwpO1xyXG4gICAgeGhyLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgaWYgKHhoci5zdGF0dXMgPT09IDIwMCkgeyAvLyBHb3QgYSBzdWNjZXNzIHJlc3BvbnNlIGZyb20gc2VydmVyIVxyXG4gICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xyXG4gICAgICAgIGNvbnN0IHJlc3RhdXJhbnRzID0ganNvbi5yZXN0YXVyYW50cztcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XHJcbiAgICAgIH0gZWxzZSB7IC8vIE9vcHMhLiBHb3QgYW4gZXJyb3IgZnJvbSBzZXJ2ZXIuXHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSAoYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHt4aHIuc3RhdHVzfWApO1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHhoci5zZW5kKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChyID0+IHIuaWQgPT0gaWQpO1xyXG4gICAgICAgIGlmIChyZXN0YXVyYW50KSB7IC8vIEdvdCB0aGUgcmVzdGF1cmFudFxyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XHJcbiAgICAgICAgfSBlbHNlIHsgLy8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2VcclxuICAgICAgICAgIGNhbGxiYWNrKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JywgbnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50c1xyXG4gICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKVxyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcigodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGkpXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxyXG4gICAgICBtYXA6IG1hcCxcclxuICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUH1cclxuICAgICk7XHJcbiAgICByZXR1cm4gbWFya2VyO1xyXG4gIH1cclxuXHJcbn1cclxuIiwibGV0IHJlc3RhdXJhbnRzLFxyXG4gIG5laWdoYm9yaG9vZHMsXHJcbiAgY3Vpc2luZXNcclxudmFyIG1hcFxyXG52YXIgbWFya2VycyA9IFtdXHJcblxyXG4vKipcclxuICogRmV0Y2ggbmVpZ2hib3Job29kcyBhbmQgY3Vpc2luZXMgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXHJcbiAqL1xyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKGV2ZW50KSA9PiB7XHJcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XHJcblx0ZmV0Y2hDdWlzaW5lcygpO1xyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5jb25zdCBmZXRjaE5laWdoYm9yaG9vZHMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKChlcnJvciwgbmVpZ2hib3Job29kcykgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvclxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XHJcbiAgICAgIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogU2V0IG5laWdoYm9yaG9vZHMgSFRNTC5cclxuICovXHJcbmNvbnN0IGZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcbiAgbmVpZ2hib3Job29kcy5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuY29uc3QgZmV0Y2hDdWlzaW5lcyA9ICgpID0+IHtcclxuICBEQkhlbHBlci5mZXRjaEN1aXNpbmVzKChlcnJvciwgY3Vpc2luZXMpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5jdWlzaW5lcyA9IGN1aXNpbmVzO1xyXG4gICAgICBmaWxsQ3Vpc2luZXNIVE1MKCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cclxuICovXHJcbmNvbnN0IGZpbGxDdWlzaW5lc0hUTUwgPSAoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG5cclxuICBjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcclxuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXHJcbiAqL1xyXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcclxuICBsZXQgbG9jID0ge1xyXG4gICAgbGF0OiA0MC43MjIyMTYsXHJcbiAgICBsbmc6IC03My45ODc1MDFcclxuICB9O1xyXG4gIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuICAgIHpvb206IDEyLFxyXG4gICAgY2VudGVyOiBsb2MsXHJcbiAgICBzY3JvbGx3aGVlbDogZmFsc2VcclxuICB9KTtcclxuICB1cGRhdGVSZXN0YXVyYW50cygpO1xyXG59XHJcblxyXG4vKipcclxuICogVXBkYXRlIHBhZ2UgYW5kIG1hcCBmb3IgY3VycmVudCByZXN0YXVyYW50cy5cclxuICovXHJcbmNvbnN0IHVwZGF0ZVJlc3RhdXJhbnRzID0gKCkgPT4ge1xyXG4gIGNvbnN0IGNTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XHJcbiAgY29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xyXG5cclxuICBjb25zdCBjSW5kZXggPSBjU2VsZWN0LnNlbGVjdGVkSW5kZXg7XHJcbiAgY29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG5cclxuICBjb25zdCBjdWlzaW5lID0gY1NlbGVjdFtjSW5kZXhdLnZhbHVlO1xyXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3RbbkluZGV4XS52YWx1ZTtcclxuXHJcbiAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcclxuICAgICAgZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXHJcbiAqL1xyXG5jb25zdCByZXNldFJlc3RhdXJhbnRzID0gKHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcbiAgdWwuaW5uZXJIVE1MID0gJyc7XHJcblxyXG4gIC8vIFJlbW92ZSBhbGwgbWFwIG1hcmtlcnNcclxuICBzZWxmLm1hcmtlcnMuZm9yRWFjaChtID0+IG0uc2V0TWFwKG51bGwpKTtcclxuICBzZWxmLm1hcmtlcnMgPSBbXTtcclxuICBzZWxmLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuY29uc3QgZmlsbFJlc3RhdXJhbnRzSFRNTCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIHVsLmFwcGVuZChjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KSk7XHJcbiAgfSk7XHJcbiAgYWRkTWFya2Vyc1RvTWFwKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxyXG4gKi9cclxuY29uc3QgY3JlYXRlUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCkgPT4ge1xyXG5cdGNvbnN0IGFydGljbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhcnRpY2xlJyk7XHJcbiAgYXJ0aWNsZS5jbGFzc05hbWUgPSAnZmxleC1jb250YWluZXInO1xyXG4gIGFydGljbGUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgcmVzdGF1cmFudC5uYW1lKTtcclxuXHRjb25zdCBhcnRpY2xlVGh1bWIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRhcnRpY2xlVGh1bWIuY2xhc3NOYW1lID0gJ2NvbC1zbS02IGNvbC1tZC01JztcclxuXHRjb25zdCBhcnRpY2xlQ29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdGFydGljbGVDb250ZW50LmNsYXNzTmFtZSA9ICdjb2wtc20tNiBjb2wtbWQtNyByZXN0YXVyYW50LWNvbnRlbnQnO1xyXG5cclxuXHQvKiBUaHVtYm5haWwgKi9cclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG5cdGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XHJcblx0aW1hZ2UuYWx0ID0gYCR7cmVzdGF1cmFudC5uYW1lfSByZXN0YXVyYW50J3MgcGhvdG9gO1xyXG5cdGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuXHRcclxuXHQvLyBTZXQgc3Jjc2V0IGZvciByZXNwb25zaXZlXHJcblx0Y29uc3QgaW1hZ2U0ODAgPSBpbWFnZS5zcmMucmVwbGFjZSgvKFxcLltcXHdcXGRfLV0rKSQvaSwgJy00ODAkMScpXHJcblx0aW1hZ2Uuc2V0QXR0cmlidXRlKCdzcmNzZXQnLCBgJHtpbWFnZTQ4MH0gNDgwdywgJHtpbWFnZS5zcmN9IDgwMHdgKTtcclxuXHRpbWFnZS5zZXRBdHRyaWJ1dGUoJ3NpemVzJywgJyhtYXgtd2lkdGg6IDU3NnB4KSA0ODBweCwgKG1heC13aWR0aDogMTIwMHB4KSA0ODBweCcpO1xyXG5cclxuXHRhcnRpY2xlVGh1bWIuYXBwZW5kKGltYWdlKTtcclxuXHRhcnRpY2xlLmFwcGVuZChhcnRpY2xlVGh1bWIpO1xyXG5cclxuXHQvKiBDb250ZW50ICovXHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgYXJ0aWNsZUNvbnRlbnQuYXBwZW5kKG5hbWUpO1xyXG5cclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xyXG4gIGFydGljbGVDb250ZW50LmFwcGVuZChuZWlnaGJvcmhvb2QpO1xyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG4gIGFydGljbGVDb250ZW50LmFwcGVuZChhZGRyZXNzKTtcclxuXHJcbiAgY29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICBtb3JlLmlubmVySFRNTCA9ICdWaWV3IERldGFpbHMnO1xyXG4gIG1vcmUuaHJlZiA9IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgbW9yZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnVmlldyBEZXRhaWxzIGFib3V0ICcrIHJlc3RhdXJhbnQubmFtZSk7XHJcblx0YXJ0aWNsZUNvbnRlbnQuYXBwZW5kKG1vcmUpO1xyXG5cdGFydGljbGUuYXBwZW5kKGFydGljbGVDb250ZW50KTtcclxuXHJcbiAgcmV0dXJuIGFydGljbGU7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxyXG4gKi9cclxuY29uc3QgYWRkTWFya2Vyc1RvTWFwID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICAvLyBBZGQgbWFya2VyIHRvIHRoZSBtYXBcclxuICAgIGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybFxyXG4gICAgfSk7XHJcbiAgICBzZWxmLm1hcmtlcnMucHVzaChtYXJrZXIpO1xyXG4gIH0pO1xyXG59IiwibGV0IHJlc3RhdXJhbnQ7XHJcbnZhciBtYXA7XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgICAgIHpvb206IDE2LFxyXG4gICAgICAgIGNlbnRlcjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgICAgIH0pO1xyXG4gICAgICBmaWxsQnJlYWRjcnVtYigpO1xyXG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxyXG4gKi9cclxuY29uc3QgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9IChjYWxsYmFjaykgPT4ge1xyXG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXHJcbiAgICBjYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpXHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xyXG4gIGlmICghaWQpIHsgLy8gbm8gaWQgZm91bmQgaW4gVVJMXHJcbiAgICBsZXQgZXJyb3IgPSAnTm8gcmVzdGF1cmFudCBpZCBpbiBVUkwnXHJcbiAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgfSBlbHNlIHtcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xyXG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xyXG4gICAgICBpZiAoIXJlc3RhdXJhbnQpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgZmlsbFJlc3RhdXJhbnRIVE1MKCk7XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpXHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcclxuICovXHJcbmNvbnN0IGZpbGxSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcclxuXHJcbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcclxuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcclxuXHJcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1pbWcnKTtcclxuXHRpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xyXG5cdGltYWdlLmFsdCA9IGAke3Jlc3RhdXJhbnQubmFtZX0gcmVzdGF1cmFudCdzIHBob3RvYDtcclxuXHRpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcblx0XHJcblx0Ly8gU2V0IHNyY3NldCBmb3IgcmVzcG9uc2l2ZVxyXG5cdGNvbnN0IGltYWdlNDgwID0gaW1hZ2Uuc3JjLnJlcGxhY2UoLyhcXC5bXFx3XFxkXy1dKykkL2ksICctNDgwJDEnKVxyXG5cdGltYWdlLnNldEF0dHJpYnV0ZSgnc3Jjc2V0JywgYCR7aW1hZ2U0ODB9IDQ4MHcsICR7aW1hZ2Uuc3JjfSA4MDB3YCk7XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jdWlzaW5lJyk7XHJcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcclxuXHJcbiAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcclxuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcclxuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XHJcbiAgfVxyXG4gIC8vIGZpbGwgcmV2aWV3c1xyXG4gIGZpbGxSZXZpZXdzSFRNTCgpO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmNvbnN0IGZpbGxSZXN0YXVyYW50SG91cnNIVE1MID0gKG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3VycykgPT4ge1xyXG4gIGNvbnN0IGhvdXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaG91cnMnKTtcclxuICBmb3IgKGxldCBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcclxuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XHJcblxyXG4gICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcclxuICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XHJcbiAgICByb3cuYXBwZW5kQ2hpbGQoZGF5KTtcclxuXHJcbiAgICBjb25zdCB0aW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcclxuICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcclxuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcclxuXHJcbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmNvbnN0IGZpbGxSZXZpZXdzSFRNTCA9IChyZXZpZXdzID0gc2VsZi5yZXN0YXVyYW50LnJldmlld3MpID0+IHtcclxuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcclxuICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gzJyk7XHJcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xyXG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aXRsZSk7XHJcblxyXG4gIGlmICghcmV2aWV3cykge1xyXG4gICAgY29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xyXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xyXG4gIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xyXG4gICAgdWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcclxuICB9KTtcclxuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5jb25zdCBjcmVhdGVSZXZpZXdIVE1MID0gKHJldmlldykgPT4ge1xyXG5cdGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuXHRjb25zdCByZXZpZXdUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdHJldmlld1RpdGxlLmNsYXNzTmFtZSA9ICdmbGV4LWNvbnRhaW5lciByZXZpZXctdGl0bGUnO1xyXG5cclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XHJcblx0bmFtZS5jbGFzc05hbWUgPSAnY29sJztcclxuXHRyZXZpZXdUaXRsZS5hcHBlbmRDaGlsZChuYW1lKTtcclxuXHJcbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBkYXRlLmlubmVySFRNTCA9IHJldmlldy5kYXRlO1xyXG5cdGRhdGUuY2xhc3NOYW1lID0gJ2NvbCB0ZXh0LXJpZ2h0JztcclxuXHRyZXZpZXdUaXRsZS5hcHBlbmRDaGlsZChkYXRlKTtcclxuXHJcblx0bGkuYXBwZW5kQ2hpbGQocmV2aWV3VGl0bGUpO1xyXG5cclxuXHRjb25zdCByZXZpZXdDb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0cmV2aWV3Q29udGVudC5jbGFzc05hbWUgPSAncmV2aWV3LWNvbnRlbnQnO1xyXG5cclxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcblx0cmF0aW5nLmlubmVySFRNTCA9IGBSYXRpbmc6ICR7cmV2aWV3LnJhdGluZ31gO1xyXG5cdHJhdGluZy5jbGFzc0xpc3QuYWRkKCdiYWRnZScpO1xyXG4gIHJldmlld0NvbnRlbnQuYXBwZW5kQ2hpbGQocmF0aW5nKTtcclxuXHJcbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xyXG5cdHJldmlld0NvbnRlbnQuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xyXG5cdFxyXG5cdGxpLmFwcGVuZENoaWxkKHJldmlld0NvbnRlbnQpO1xyXG5cclxuICByZXR1cm4gbGk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxyXG4gKi9cclxuY29uc3QgZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudD1zZWxmLnJlc3RhdXJhbnQpID0+IHtcclxuICBjb25zdCBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcblx0bGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG5cdGxpLnNldEF0dHJpYnV0ZSgnYXJpYS1sZXZlbCcsIDIpO1xyXG4gIGxpLnNldEF0dHJpYnV0ZSgnYXJpYS1jdXJyZW50JywgJ3BhZ2UnKTtcclxuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXHJcbiAqL1xyXG5jb25zdCBnZXRQYXJhbWV0ZXJCeU5hbWUgPSAobmFtZSwgdXJsKSA9PiB7XHJcbiAgaWYgKCF1cmwpXHJcbiAgICB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcclxuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XHJcbiAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBbPyZdJHtuYW1lfSg9KFteJiNdKil8JnwjfCQpYCksXHJcbiAgICByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xyXG4gIGlmICghcmVzdWx0cylcclxuICAgIHJldHVybiBudWxsO1xyXG4gIGlmICghcmVzdWx0c1syXSlcclxuICAgIHJldHVybiAnJztcclxuICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csICcgJykpO1xyXG59Il19
